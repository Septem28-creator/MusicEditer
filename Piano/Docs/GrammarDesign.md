# 音乐符号抽象语言设计(grammar)

## 1. 基础元素定义

### 1.1 音名 (Pitch Name)
- 使用大写字母表示基本音级: C, D, E, F, G, A, B
- 升号: # (如 C#)
- 降号: b (如 Db)
- 还原号: ♮ (如 C♮，通常省略)

### 1.2 音高 (Octave)
- 采用科学音高记号法，中央C为C4
- 八度范围: C0 - G9 (覆盖钢琴88键)
- 音高标记在音名后，如 C4, D5

### 1.3 时值 (Duration)
- 全音符: 1
- 二分音符: 1/2
- 四分音符: 1/4
- 八分音符: 1/8
- 十六分音符: 1/16
- 三十二分音符: 1/32
- 附点音符: 在时值后加点(.)，如 1/4. 表示1/4 + 1/8 = 3/8拍

### 1.4 休止符 (Rest)
- 用 R 表示休止符
- 时值标记方式与音符相同，如 R(1/4), R(1/8).

### 1.5 节拍速度 (BPM)
- 用 [BPM=数值] 表示，如 [BPM=120]
- 默认BPM为120

### 1.6 调号 (Key Signature)
- 大调: [KEY=C] 表示C大调
- 小调: [KEY=Am] 表示A小调

### 1.7 连音线 (Tie)
- 用 - 连接两个相同音高的音符，如 C4(1/4)- C4(1/4) 表示二分音符的C4

### 1.8 颤音 (Vibrato)
- 用 ~ 表示颤音效果，标记在音符时值之后
- 例如: C4(1/4)~ 表示带有颤音的四分音符C4

### 1.9 倚音 (Grace Note)
- 用 \ 表示倚音，标记在主音符之前
- 例如: \G4 G4(1/2) 表示G4的八分音符倚音后接主音符G4的四分音符

### 1.10 滑音 (Glissando)
- 用 \\ 表示滑音，标记在起始音符之前
- 例如: \\C4 G4(1/2) 表示从C4滑音到G4的四分音符
- 滑音持续时间由目标音符的时值决定

### 1.11 强弱记号 (Dynamics)
- p (pianissimo): 很弱
- pp (pianississimo): 极弱
- mp (mezzo-piano): 中弱
- mf (mezzo-forte): 中强
- f (forte): 强
- ff (fortissimo): 很强
- fff (fortississimo): 极强

### 1.11 和弦 (Chord)
- 用大括号{}包围多个音符表示和弦
- 和弦中的音符用逗号分隔
- 例如: {C4,E4,G4}(1/4) 表示C大三和弦的四分音符

### 1.12 声部 (Voice)
- 用 [PART-名称] 表示声部，例如 [PART-MELODY] 或 [PART-A]
- 声部内容在 [PART-名称] 和 [/PART-名称] 之间
- 不同声部可以同时进行

## 2. 语法规则

### 2.1 基本结构
- 音符表示: 音名+八度(时值)，例如: C4(1/4) 表示四分音符的中央C
- 连音表示: 在音符后加 -，例如: C4(1/4)- C4(1/4) 表示二分音符的C4
- 颤音表示: 在音符时值后加 ~，例如: C4(1/4)~ 表示带有颤音的四分音符C4
- 倚音表示: 在主音符前加 \，例如: \G4 G4(1/2) 表示G4的八分音符倚音后接主音符G4的四分音符
- 休止符表示: R(时值)，例如: R(1/4) 表示四分休止符

### 2.2 小节分隔
- 用 | 分隔小节
- 例如: C4(1/4) D4(1/4) E4(1/4) F4(1/4) |

### 2.3 注释
- 单行注释: //
- 多行注释: /* */

### 2.4 段落标记
- 前奏: [INTRO]
- 间奏: [INTERLUDE]
- 重复段: [REPEAT] ... [/REPEAT]

### 2.5 和弦
- 用大括号{}包围多个音符表示和弦
- 和弦中的音符用逗号分隔
- 和弦具有统一的时值
- 例如: {C4,E4,G4}(1/4) 表示C大三和弦的四分音符

### 2.6 多声部结构
- 使用 [VOICES] 标记开始多声部定义
- 每个声部用 [PART-名称] 标记
- 声部内容在 [PART-名称] 和 [/PART-名称] 之间
- 用 [/VOICES] 结束多声部定义

## 3. 完整示例

```
[BPM=120]
[KEY=C]

[VOICES]
[PART-MELODY]
C5(1/4)~ D5(1/4)~ E5(1/4)~ F5(1/4)~ |
\G4 G5(1/2) \A4 A5(1/2) |
[/PART-MELODY]

[PART-HARMONY]
E4(1/2) G4(1/2) |
C5(1/2) E5(1/2) |
[/PART-HARMONY]

[PART-BASS]
C3(1) |
G3(1) |
[/PART-BASS]
[/VOICES]
```